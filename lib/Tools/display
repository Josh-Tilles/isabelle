#!/usr/bin/env bash
#
# $Id$
# Author: Markus Wenzel, TU Muenchen
#
# DESCRIPTION: display document (in DVI or PDF format)


PRG="$(basename "$0")"

function usage()
{
  echo
  echo "Usage: $PRG [OPTIONS] FILE"
  echo
  echo "  Options are:"
  echo "    -c           cleanup -- remove FILE after use"
  echo
  echo "  Display document FILE (in DVI or PDF format)."
  echo
  exit 1
}

function fail()
{
  echo "$1" >&2
  exit 2
}


function view()
{
  if [ "${1%%.dvi}.dvi" == "$1" ]; then
    exec $DVI_VIEWER "$1"
    return
  fi

  if [ "${1%%.pdf}.pdf" == "$1" ]; then
    exec $PDF_VIEWER "$1"
    return
  fi

  fail "Unknown file type: $FILE";
}

## process command line

# options

CLEAN=""

while getopts "c" OPT
do
  case "$OPT" in
    c)
      CLEAN=true
      ;;
    \?)
      usage
      ;;
  esac
done

shift $(($OPTIND - 1))


# args

[ "$#" -ne 1 ] && usage

FILE="$1"; shift


## main

[ -f "$FILE" ] || fail "Bad file: $FILE"

if [ -n "$CLEAN" ]; then
  PRIVATE_FILE="$ISABELLE_TMP/"$(basename "$FILE")
  mv "$FILE" "$PRIVATE_FILE" ##|| fail "Cannot move file: $FILE"
  view "$PRIVATE_FILE"
  rm -f "$PRIVATE_FILE"
else
  view "$FILE"
fi
